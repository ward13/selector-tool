<!DOCTYPE html>
<html lang="en">
<head>
<!--  This file is 'selector-tool.html' (2025-10-10).                                 -->
<!--                                                                                  -->
<!--  'selector-tool.html' is free software: you can redistribute it and/or modify    -->
<!--  it under the terms of the GNU General Public License as published by            -->
<!--  the Free Software Foundation, either version 3 of the License, or               -->
<!--  (at your option) any later version.                                             -->
<!--                                                                                  -->
<!--  'selector-tool.html' is distributed in the hope that it will be useful,         -->
<!--  but WITHOUT ANY WARRANTY; without even the implied warranty of                  -->
<!--  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the                    -->
<!--  GNU General Public License for more details.                                    -->
<!--                                                                                  -->
<!--  The GNU General Public License is available at <http://www.gnu.org/licenses/>.  -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Name Selection Tool</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 900px;
        }

        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }

        .input-section {
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        button {
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: white;
            transition: background-color 0.3s ease;
        }

        #btn-load { background-color: #3498db; }
        #btn-load:hover { background-color: #2980b9; }

        #btn-select { background-color: #2ecc71; }
        #btn-select:hover { background-color: #27ae60; }
        #btn-select:disabled { background-color: #bdc3c7; cursor: not-allowed; }

        #btn-reset { background-color: #e74c3c; }
        #btn-reset:hover { background-color: #c0392b; }

        .result-display {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background-color: #ecf0f1;
            border-radius: 5px;
            min-height: 50px;
        }
        
        #last-selected {
            font-size: 2rem;
            font-weight: bold;
            color: #e67e22;
        }

        .pools-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
        }

        .pool {
            width: 48%;
            min-height: 200px;
            background-color: #f9f9f9;
            border: 2px dashed #ccc;
            border-radius: 5px;
            padding: 15px;
        }

        .pool h3 {
            margin-top: 0;
            text-align: center;
            color: #7f8c8d;
        }

        .pool ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .pool li {
            background-color: #ffffff;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: grab;
            transition: background-color 0.2s;
        }

        .pool li:hover {
            background-color: #eef8ff;
        }

        .dragging {
            opacity: 0.5;
            background-color: #cceeff;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Name Selection Tool</h1>

        <div class="input-section">
            <label for="name-input">Paste a list of names separated by commas or new lines:</label>
            <textarea id="name-input" placeholder="e.g., Alice, Bob, Charlie, Diana"></textarea>
        </div>

        <div class="controls">
            <button id="btn-load">Load Names</button>
            <button id="btn-select">Select Random Name</button>
            <button id="btn-reset">Reset All</button>
        </div>

        <div class="result-display">
            <h2>Last Selected Name:</h2>
            <p id="last-selected">---</p>
        </div>

        <div class="pools-container">
            <div id="selection-pool" class="pool">
                <h3>Selection Pool</h3>
                <ul id="pool-list"></ul>
            </div>
            <div id="selected-pool" class="pool">
                <h3>Already Selected</h3>
                <ul id="selected-list"></ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const nameInput = document.getElementById('name-input');
            const loadBtn = document.getElementById('btn-load');
            const selectBtn = document.getElementById('btn-select');
            const resetBtn = document.getElementById('btn-reset');
            const lastSelectedDisplay = document.getElementById('last-selected');
            const poolList = document.getElementById('pool-list');
            const selectedList = document.getElementById('selected-list');
            const selectionPoolDiv = document.getElementById('selection-pool');
            const selectedPoolDiv = document.getElementById('selected-pool');

            // --- Child Windows ---
            let revealWindow = null;
            
            let nameIdCounter = 0;

            // --- Core Functions ---

            const loadNames = () => {
                const namesText = nameInput.value.trim();
                if (!namesText) {
                    alert('Please enter a list of names.');
                    return;
                }

                // Clear existing lists
                poolList.innerHTML = '';
                selectedList.innerHTML = '';
                lastSelectedDisplay.textContent = '---';

                const names = namesText.split(/[,|\n|\r\n]+/).map(name => name.trim()).filter(name => name !== '');
                
                names.forEach(name => {
                    const li = createNameListItem(name);
                    poolList.appendChild(li);
                });
                openRevealWindow('Ready to go!');
                updateSelectButtonState();
            };

            const selectRandomName = () => {
                const availableItems = poolList.querySelectorAll('li');
                if (availableItems.length === 0) {
                    lastSelectedDisplay.textContent = 'No names left!';
                    openRevealWindow('No names left');
                    updateSelectButtonState();
                    return;
                }

                const randomIndex = Math.floor(Math.random() * availableItems.length);
                const winnerElement = availableItems[randomIndex];
                const winnerName = winnerElement.textContent;

                // Display and move
                lastSelectedDisplay.textContent = winnerName;
                selectedList.appendChild(winnerElement);

                // Update child windows
                updateRevealWindow(winnerName);
//                openControlWindow(); // Open or focus control window
                
                updateSelectButtonState();
            };
            
            // Expose function to the global scope for the child window to call
            window.selectRandomName = selectRandomName;

            const resetAll = () => {
                const allSelectedItems = selectedList.querySelectorAll('li');
                allSelectedItems.forEach(item => {
                    poolList.appendChild(item);
                });
                lastSelectedDisplay.textContent = '---';
                openRevealWindow('Ready to go!');
                updateSelectButtonState();
            };

            window.resetAll = resetAll;

            const updateSelectButtonState = () => {
                noNamesLeft = poolList.children.length === 0;
                const winNext = revealWindow.document.getElementById("winNext");
                const winReset = revealWindow.document.getElementById("winReset");

                if (noNamesLeft) {
                    selectBtn.disabled = true;
                    if (winNext !== null) {
                        winNext.disabled = true;
                        winNext.innerHTML = 'no names left';

                    }
                }
                else {
                    selectBtn.disabled = false;
                    if (winNext !== null) {
                        winNext.disabled = false;
                        winNext.innerHTML = 'Go';
                    }
                }

            };

            // --- Child Window Management ---

            const updateRevealWindow = (name) => {
                if (!revealWindow || revealWindow.closed) {
                    revealWindow = window.open('', 'revealWindow', 'width=500,height=300,top=100,left=100');
                }
                revealWindow.focus();
                
                const revealDoc = revealWindow.document;
                revealDoc.body.innerHTML = `
                    <head><title>Reveal Window</title></head>
                    <style>
                        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #2c3e50; color: white; text-align: center; }
                        .content { transform: scale(1.2); }
                        #countdown { font-size: 2.5rem; margin-bottom: 0px; }
                        #winner-name { font-size: 2.5rem; font-weight: bold; color: #f1c40f; visibility: hidden; }
                    </style>
                    <div class="content">
                        <h1 id="winTitle">Choosing name...</h1>
                        <div id="countdown">3</div>
                        <div id="winner-name"><span id="nameOnly">${name}</span><br><br style="line-height:10px"><button id="winNext" onclick="window.opener.selectRandomName()">Next</button>&nbsp;<button onclick="document.getElementById('nameOnly').innerHTML=''">Clear</button>&nbsp;<button id="winReset" onclick="window.opener.resetAll()">Reset</button></div>
                    </div>
                `;

                let count = 3;
                const countdownElement = revealDoc.getElementById('countdown');
                const winnerNameElement = revealDoc.getElementById('winner-name');
                const winTitle = revealDoc.getElementById("winTitle");

                const timer = setInterval(() => {
                    count--;
                    if (count > 0) {
                        countdownElement.textContent = count;
                    } else {
                        clearInterval(timer);
                        countdownElement.style.display = 'none';
                        winnerNameElement.style.visibility = 'visible';
                        winTitle.innerHTML = "Selected name is...";
                    }
                }, 500);
            };

            const openRevealWindow = (revMess) => {
                if (!revealWindow || revealWindow.closed) {
                    revealWindow = window.open('', 'revealWindow', 'width=500,height=300,top=100,left=100');
                }
                revealWindow.focus();
                
                const revealDoc = revealWindow.document;
                revealDoc.body.innerHTML = `
                    <head><title>Reveal Window</title></head>
                    <style>
                        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #2c3e50; color: white; text-align: center; }
                        .content { transform: scale(1.2); }
                        #countdown { font-size: 2.5rem; margin-bottom: 0px; }
                        #winner-name { font-size: 2.5rem; font-weight: bold; color: #f1c40f; visibility: hidden; }
                    </style>
                    <div class="content">
                        <h1>${revMess}</h1>
                        <div><button id="winNext" onclick="window.opener.selectRandomName()">Go</button></div>
                    </div>
                `;

            };

            // Expose function to the global scope for the child window to call
            window.openRevealWindow = openRevealWindow;

            // --- Drag and Drop ---

            const createNameListItem = (name) => {
                const li = document.createElement('li');
                li.textContent = name;
                li.draggable = true;
                li.id = 'name-item-' + nameIdCounter++;
                
                li.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.id);
                    setTimeout(() => e.target.classList.add('dragging'), 0);
                });
                
                li.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                });
                return li;
            };

            const setupDragAndDropListeners = (poolElement) => {
                poolElement.addEventListener('dragover', (e) => {
                    e.preventDefault(); // This is necessary to allow dropping
                });
                
                poolElement.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const id = e.dataTransfer.getData('text/plain');
                    const draggableElement = document.getElementById(id);
                    
                    // Find the UL inside the target pool div
                    const targetList = e.currentTarget.querySelector('ul');
                    if (targetList) {
                        targetList.appendChild(draggableElement);
                    }
                    updateSelectButtonState();
                });
            };

            // --- Event Listeners ---
            loadBtn.addEventListener('click', loadNames);
            selectBtn.addEventListener('click', selectRandomName);
            resetBtn.addEventListener('click', resetAll);
            
            setupDragAndDropListeners(selectionPoolDiv);
            setupDragAndDropListeners(selectedPoolDiv);
            
            updateSelectButtonState();
        });
    </script>
</body>
</html>
